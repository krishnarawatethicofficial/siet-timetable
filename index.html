<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Timetable</title>
<style>
:root{--bg:#0b0f15;--panel:#121825;--muted:#8aa1b1;--text:#e7eef5;--accent:#5cc8ff;--ok:#4ade80;--warn:#fbbf24;--danger:#fb7185;--card:#0f1522;--shadow:0 10px 30px rgba(0,0,0,.35)}
body.light{--bg:#f7f9fc;--panel:#ffffff;--muted:#5a6c7f;--text:#17223b;--accent:#3a7afe;--ok:#198754;--warn:#f59e0b;--danger:#dc3545;--card:#ffffff;--shadow:0 6px 20px rgba(0,0,0,.1)}
body.sky{--bg:#e0f7fa;--panel:#ffffff;--muted:#5a7aa5;--text:#12263a;--accent:#00bcd4;--ok:#2ca58d;--warn:#ffb74d;--danger:#ff8a65;--card:#ffffff;--shadow:0 6px 20px rgba(0,128,255,.15)}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font:500 16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;transition:background-color .3s,color .3s}
.wrap{max-width:980px;margin:24px auto;padding:0 16px 40px}
header{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:18px}
h1{font-size:clamp(20px,3.5vw,28px);margin:0;letter-spacing:.3px}
.badge{display:inline-flex;align-items:center;border:1px solid rgba(32,48,71,.5);background:var(--panel);padding:8px 12px;border-radius:14px;color:var(--muted);gap:8px}
.card{background:var(--card);border:1px solid rgba(29,42,63,.4);border-radius:16px;box-shadow:var(--shadow);overflow:hidden}
.card>.hd{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:14px 16px;border-bottom:1px solid rgba(29,42,63,.4)}
.card>.bd{padding:16px}
.tag{font-size:12px;padding:4px 8px;border-radius:999px;background:var(--panel);border:1px solid rgba(32,48,71,.5);color:var(--muted)}
.row{display:flex;gap:14px;align-items:center}
.pill{padding:6px 10px;border-radius:999px;border:1px solid rgba(32,48,71,.5);background:var(--panel);color:var(--muted);text-decoration:none}
.big{font-size:clamp(22px,3vw,30px);font-weight:700;line-height:1.2}
.time{font-variant-numeric:tabular-nums;letter-spacing:.3px}
</style>
</head>
<body class="sky">
<div class="wrap">
<header>
<h1>Timetable</h1>
<div class="badge"><span id="dateLeft">—</span><span id="clock">—</span></div>
<a class="pill" href="/holidays.html">Manage schedule</a>
</header>
<section class="card" style="margin-top:16px"><div class="hd"><span class="tag" id="dayLabel">Today</span><span class="muted"></span></div><div class="bd"><div id="holidayInfo" class="holiday-info" style="display:none"></div><div class="timeline" id="timeline"></div></div></section>
</div>
<script>
const $=s=>document.querySelector(s),pad=n=>String(n).padStart(2,'0'),toMin=t=>{const[h,m]=t.split(':').map(Number);return h*60+m},to12=hm=>{let[h,m]=hm.split(':').map(Number);const ap=h>=12?'PM':'AM';h=(h%12)||12;return h+':'+pad(m)+' '+ap},nowIST=()=>{const d=new Date();const s=new Intl.DateTimeFormat('en-IN',{hour:'2-digit',minute:'2-digit',hour12:true,timeZone:'Asia/Kolkata'}).format(d);return s.replace(/^0/,'')};
const LS_THEME='live-timetable-theme',LS_OFFICIAL='officialHolidays',LS_SPECIAL='specialHolidays',LS_OFFICIAL_PROOF='officialProofPdf';
function applyTheme(){const t=localStorage.getItem(LS_THEME)||'dark';document.body.classList.remove('light','sky');if(t==='light')document.body.classList.add('light');if(t==='sky')document.body.classList.add('sky')}
function dayName(d){return d.toLocaleDateString('en-IN',{weekday:'long'})}
function syncFromRemote(){return fetch('/.netlify/functions/holidays',{cache:'no-store'}).then(r=>{if(!r.ok)return null;return r.json()}).then(j=>{if(!j)return;localStorage.setItem(LS_OFFICIAL,JSON.stringify(j.officialHolidays||[]));localStorage.setItem(LS_SPECIAL,JSON.stringify(j.specialHolidays||[]));localStorage.setItem(LS_OFFICIAL_PROOF,JSON.stringify(('officialProof'in j)?j.officialProof:null))}).catch(()=>{})}
function getHolidaysForDate(date){const off=JSON.parse(localStorage.getItem(LS_OFFICIAL)||'[]');const spc=JSON.parse(localStorage.getItem(LS_SPECIAL)||'[]');const pad2=n=>String(n).padStart(2,'0');const md=pad2(date.getMonth()+1)+'-'+pad2(date.getDate());const ymd=date.getFullYear()+'-'+pad2(date.getMonth()+1)+'-'+pad2(date.getDate());const out=[];const mdInt=s=>parseInt(s.replace('-',''),10);off.forEach(h=>{if(h.start&&((mdInt(md)>=mdInt(h.start)&&mdInt(md)<=mdInt(h.end||h.start))||(mdInt(h.start)>mdInt(h.end||h.start)&&(mdInt(md)>=mdInt(h.start)||mdInt(md)<=mdInt(h.end||h.start)))))out.push({scope:'official',name:h.name||'Holiday',range:h.end&&h.end!==h.start?h.start+' – '+h.end:h.start,desc:h.desc||'',bullets:h.bullets||[]})});const ymdInt=s=>parseInt(s.replace(/-/g,''),10);spc.forEach(h=>{const a=ymdInt(h.start),b=ymdInt(h.end||h.start),x=ymdInt(ymd);if(a&&x&&(x>=Math.min(a,b)&&x<=Math.max(a,b)))out.push({scope:'special',name:h.name||'Holiday',range:h.end&&h.end!==h.start?h.start+' – '+h.end:h.start,desc:h.desc||'',bullets:h.bullets||[]})});return out}
function fmtOfficialRange(r){return r.split(' – ').map(s=>{const[m,d]=s.split('-');return d+'-'+m}).join(' – ')}
function fmtSpecialRange(r){return r.split(' – ').map(s=>{const[y,m,d]=s.split('-');return d+'-'+m+'-'+y}).join(' – ')}
function render(){const now=new Date();document.getElementById('dateLeft').textContent=now.toLocaleDateString('en-IN',{day:'numeric',month:'long',year:'numeric'});document.getElementById('clock').textContent=nowIST();const h=getHolidaysForDate(now);const el=document.getElementById('holidayInfo');const tl=document.getElementById('timeline');if(h.length){const parts=h.map(x=>'<div><h3>'+x.name+'</h3><div class="range">'+(x.scope==='official'?fmtOfficialRange(x.range):fmtSpecialRange(x.range))+'</div>'+(x.desc?'<div class="desc">'+x.desc+'</div>':'')+((x.bullets||[]).length?'<ul>'+x.bullets.map(li=>'<li>'+li+'</li>').join('')+'</ul>':'')+'</div>').join('');el.innerHTML='<div>'+parts+'</div>';el.style.display='block';tl.innerHTML='';return}else{el.style.display='none'}}
applyTheme();(async()=>{try{await syncFromRemote()}catch(e){}render();setInterval(render,30000)})();</script>
</body></html>
